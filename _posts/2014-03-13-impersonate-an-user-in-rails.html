---
layout: post
title: Impersonate an user in Rails
date: 2014-03-13 19:21:21.000000000 -05:00
type: post
published: true
status: publish
categories:
- Ruby on Rails
tags: []
meta:
  _publicize_pending: '1'
  is_reblog: '1'
  post_id: '311'
  blog_id: '2975830'
  reblog_snapshot: "O:8:\"stdClass\":7:{s:5:\"title\";s:28:\"Impersonate an user in
    Rails\";s:4:\"type\";s:4:\"post\";s:9:\"mime_type\";s:0:\"\";s:6:\"format\";b:0;s:12:\"modified_gmt\";s:19:\"2010-03-31
    10:42:36\";s:9:\"permalink\";s:78:\"http://adhirajrankhambe.wordpress.com/2009/02/15/impersonate-an-user-in-rails/\";s:7:\"content\";s:7105:\"<div
    class=\"reblogged-content\">I have been using Rick Olson's <a href=\"http://agilewebdevelopment.com/plugins/restful_authentication\"
    target=\"_blank\">restful_authentication</a> plugin for quite some time now.\r\n\r\nRecently
    I came across a requirement where the Site Admin was required to be able, to impersonate
    any user on the site.\r\n\r\nHere's how I achieved this:\r\n\r\n<strong>Approach</strong>:\r\n\r\nWhen
    â\x80\x9CSite Adminâ\x80\x9D logs-in on the site, I create two sessions namely:\r\n\r\n<code>session[:user_id]</code>\r\n<code>session[:original_user_id]</code>\r\n\r\nIf
    the Site Admin impersonates an user on the site,\r\n\r\nreplace the â\x80\x9Csession[:user_id]â\x80\x9D
    with the id of the user we wish to impersonate.\r\n\r\nSo the Site Admin becomes
    the intended user.\r\n\r\nWhenever Site Admin wants to stop impersonating,\r\n\r\nreplace
    â\x80\x9Csession[:user_id]â\x80\x9D data with â\x80\x9Csession[:original_user_id]â\x80\x9D\r\n\r\nSite
    Admin regains original admin profile.\r\n\r\n<strong>Implementation:</strong>\r\n\r\n<em>lib/authenticated_system.rb</em>
    (Generated by restful_authentication plugin)\r\n\r\n<code># Store the given user
    id in the session.\r\ndef current_user=(new_user)\r\n  session[:user_id] = new_user
    ? new_user.id : nil\r\n  @current_user = new_user || false\r\nend</code>\r\n\r\nI
    overloaded this method in my <em>Application Controller</em>:\r\n\r\n<code>def
    current_user=(new_user)\r\n  super</code>\r\n    \r\n<code>  if new_user &amp;&amp;
    new_user.isAdmin?\r\n    session[:original_user_id] = new_user.id\r\n  end\r\nend</code>\r\n\r\nYou
    could as well modify the file <em>lib/authenticated_system.rb</em> (I won't recommend
    it though)\r\n\r\n<em>isAdmin?</em> is a helper action in the User model\r\n\r\n<em>app/models/user.rb</em>\r\n\r\n<code>def
    isAdmin?\r\n  return roles.include?(Role.find_by_name('Administrator'))\r\nend</code>\r\n\r\nThe
    above action is very specific to my project's ERM. You could as well use:\r\n\r\n<code>def
    isAdmin?\r\n  return login == â\x80\x9Cadminâ\x80\x9D\r\nend</code>\r\n\r\nIn
    your view:\r\n\r\n<code>&lt;%= link_to \"Impersonate\", {:controller =&gt; \"admin\",
    :action =&gt; \"impersonate\", :user_id =&gt; user.id} %&gt;\r\n</code>\r\n\r\nHere's
    the actual code you have been looking for since you started reading this article:\r\n\r\n<code>def
    impersonate\r\n  if current_user &amp;&amp; current_user.isAdmin?\r\n    session[:user_id]
    = params[:user_id]\r\n    redirect_to :controller =&gt; 'users', :action =&gt;
    params[:user_id]\r\n  end\r\nend</code>\r\n\r\nIn order to stop impersonating,\r\n\r\nIn
    your view:\r\n\r\n<code>&lt;% if @current_user %&gt;\r\n  &lt;% if session[:original_user_id]
    &amp;&amp; User.find(session[:original_user_id]).isAdmin? &amp;&amp; session[:original_user_id]
    != session[:user_id] %&gt;\r\n    &lt;%= link_to \"Administer\", {:controller
    =&gt; \"admin\", :action =&gt; \"stop_impersonating\"} %&gt;\r\n  &lt;% else %&gt;\r\n    &lt;%=
    link_to \"Logout\", '/logout' %&gt;\r\n  &lt;% end %&gt;\r\n&lt;% else %&gt;\r\n  &lt;%=
    link_to \"Login\", '/login'} %&gt;\r\n&lt;% end %&gt;</code>\r\n\r\nAction to
    stop impersonating:\r\n\r\n<code>def stop_impersonating\r\n  if session[:original_user_id]
    &amp;&amp; User.find(session[:original_user_id]).isAdmin?\r\n    session[:user_id]
    = session[:original_user_id]\r\n    redirect_to :controller =&gt; \"site\", :action
    =&gt; \"home\"\r\n  end\r\nend</code>\r\n\r\nAfter brainstorming over various
    approaches, this was the easiest solution I found to achieve impersonation.\r\nMight
    not be the best solution. Looking forward for your feedback.\r\n\r\n<p style=\"text-align:left;\"
    class=\"getsocial\"><a title=\"Add to Facebook\" href=\"http://www.facebook.com/sharer.php?u=http://adhirajrankhambe.wordpress.com/2009/02/15/impersonate-an-user-in-rails/\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3012.png\" alt=\"Add
    to Facebook\"></a><a title=\"Add to Digg\" href=\"http://digg.com/submit?phase=2&amp;url=http%3A%2F%2Fadhirajrankhambe.wordpress.com%2F2009%2F02%2F15%2Fimpersonate-an-user-in-rails%2F&amp;title=Impersonate%20an%20user%20in%20Rails\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3022.png\" alt=\"Add
    to Digg\"></a><a title=\"Add to Del.icio.us\" href=\"http://del.icio.us/post?url=http%3A%2F%2Fadhirajrankhambe.wordpress.com%2F2009%2F02%2F15%2Fimpersonate-an-user-in-rails%2F&amp;title=Impersonate%20an%20user%20in%20Rails\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3032.png\" alt=\"Add
    to Del.icio.us\"></a><a title=\"Add to Stumbleupon\" href=\"http://www.stumbleupon.com/submit?url=http%3A%2F%2Fadhirajrankhambe.wordpress.com%2F2009%2F02%2F15%2Fimpersonate-an-user-in-rails%2F&amp;title=Impersonate%20an%20user%20in%20Rails\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3042.png\" alt=\"Add
    to Stumbleupon\"></a><a title=\"Add to Reddit\" href=\"http://reddit.com/submit?url=http%3A%2F%2Fadhirajrankhambe.wordpress.com%2F2009%2F02%2F15%2Fimpersonate-an-user-in-rails%2F&amp;title=Impersonate%20an%20user%20in%20Rails\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3052.png\" alt=\"Add
    to Reddit\"></a><a title=\"Add to Blinklist\" href=\"http://www.blinklist.com/index.php?Action=Blink/addblink.php&amp;Description=&amp;Url=http%3A%2F%2Fadhirajrankhambe.wordpress.com%2F2009%2F02%2F15%2Fimpersonate-an-user-in-rails%2F&amp;Title=Impersonate%20an%20user%20in%20Rails\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3062.png\" alt=\"Add
    to Blinklist\"></a><a title=\"Add to Twitter\" href=\"http://twitter.com/home/?status=Impersonate%20an%20user%20in%20Rails+%40+http%3A%2F%2Fadhirajrankhambe.wordpress.com%2F2009%2F02%2F15%2Fimpersonate-an-user-in-rails%2F\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3072.png\" alt=\"Add
    to Twitter\"></a><a title=\"Add to Technorati\" href=\"http://www.technorati.com/faves?add=http://adhirajrankhambe.wordpress.com/2009/02/15/impersonate-an-user-in-rails/\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3082.png\" alt=\"Add
    to Technorati\"></a><a title=\"Add to Yahoo Buzz\" href=\"http://buzz.yahoo.com/buzz?targetUrl=http%3A%2F%2Fadhirajrankhambe.wordpress.com%2F2009%2F02%2F15%2Fimpersonate-an-user-in-rails%2F&amp;headline=Impersonate%20an%20user%20in%20Rails\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3092.png\" alt=\"Add
    to Yahoo Buzz\"></a><a title=\"Add to Newsvine\" href=\"http://www.newsvine.com/_wine/save?u=http%3A%2F%2Fadhirajrankhambe.wordpress.com%2F2009%2F02%2F15%2Fimpersonate-an-user-in-rails%2F&amp;h=Impersonate%20an%20user%20in%20Rails\"
    rel=\"nofollow\" target=\"_blank\"><img style=\"border:0;margin:0;padding:0;\"
    src=\"http://getsocialserver.wordpress.com/files/2009/08/gs3102.png\" alt=\"Add
    to Newsvine\"></a></p>\n</div>\";}"
author:
  login: broberts65
  email: broberts_az@yahoo.com
  display_name: Bob Roberts
  first_name: ''
  last_name: ''
---

